<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Font Awesome 6.4 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <!-- Custom styles -->
  <link href="/css/modern-dashboard.css" rel="stylesheet" />
</head>

<body>
  <% /* ‚úÖ FIXED: Look for 'stats' instead of 'resumeStats' */ %>
  <% const safeStats = (typeof stats !== 'undefined')
        ? stats
        : { uploaded: 0, processed: 0, screenings: 0, topScore: 0 }; %>

  <!-- ‚úÖ Store data in a hidden div for JavaScript access -->
  <div id="dashboard-data" style="display:none;" data-stats='<%- JSON.stringify(safeStats) %>'></div>

  <!-- Modern Header
  <header class="modern-header">
    <div class="brand-name">
      <i class="fas fa-search-plus"></i>
      Resume Screener
    </div>
  </header> -->

  <!-- Dashboard Container -->
  <div class="dashboard-container">
    <h1 class="dashboard-title">
      <i class="fas fa-chart-line"></i>
      Resume Screening Dashboard
    </h1>

    <!-- Clickable Stats Grid -->
    <div class="stats-grid">
      <!-- Resumes Uploaded -->
      <a href="/dashboard/resumes/uploaded" class="stat-card-link">
        <div class="stat-card uploaded clickable-card">
          <div class="stat-value" id="uploaded-count"><%= safeStats.uploaded %></div>
          <div class="stat-label">
            <i class="fas fa-upload"></i>
            Resumes Uploaded
          </div>
          <div class="card-action"><i class="fas fa-eye"></i> View Details</div>
        </div>
      </a>

      <!-- Resumes Processed -->
      <a href="/dashboard/resumes/processed" class="stat-card-link">
        <div class="stat-card processed clickable-card">
          <div class="stat-value" id="processed-count"><%= safeStats.processed %></div>
          <div class="stat-label">
            <i class="fas fa-check-circle"></i>
            Resumes Processed
          </div>
          <div class="card-action"><i class="fas fa-eye"></i> View Details</div>
        </div>
      </a>

      <!-- Screenings Completed -->
      <a href="/dashboard/screenings" class="stat-card-link">
        <div class="stat-card screenings clickable-card">
          <div class="stat-value" id="screenings-count"><%= safeStats.screenings %></div>
          <div class="stat-label">
            <i class="fas fa-filter"></i>
            Screenings Completed
          </div>
          <div class="card-action"><i class="fas fa-eye"></i> View Details</div>
        </div>
      </a>

      <!-- Top Match Score -->
      <a href="/dashboard/resumes/top-scores" class="stat-card-link">
        <div class="stat-card score clickable-card">
          <div class="stat-value" id="top-score"><%= safeStats.topScore %>%</div>
          <div class="stat-label">
            <i class="fas fa-trophy"></i>
            Top Match Score
          </div>
          <div class="card-action"><i class="fas fa-eye"></i> View Details</div>
        </div>
      </a>
    </div>

    <!-- Action Buttons -->
    <div class="actions-container">
      <a href="/upload" class="action-btn btn-upload">
        <i class="fas fa-cloud-upload-alt icon"></i>
        Upload Resumes
      </a>
      <a href="/screening" class="action-btn btn-screen">
        <i class="fas fa-user-check icon"></i>
        Screen Candidates
      </a>
    </div>
  </div>

  <!-- Bootstrap bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- ‚úÖ FIXED: Clean JavaScript with no EJS syntax errors -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      try {
        const dashboardData = document.getElementById('dashboard-data');
        if (dashboardData) {
          const statsData = dashboardData.getAttribute('data-stats');
          const safeStats = JSON.parse(statsData);
          console.log('üìä Dashboard Stats Received:', safeStats);
          
          // Update display values if needed
          document.getElementById('uploaded-count').textContent = safeStats.uploaded;
          document.getElementById('processed-count').textContent = safeStats.processed;
          document.getElementById('screenings-count').textContent = safeStats.screenings;
          document.getElementById('top-score').textContent = safeStats.topScore + '%';
        } else {
          console.warn('‚ö†Ô∏è Dashboard data element not found');
        }
      } catch (error) {
        console.error('‚ùå Error parsing dashboard stats:', error);
      }
    });
  </script>
</body>
</html>
