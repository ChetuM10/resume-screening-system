<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Candidate Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/modern-dashboard.css" />
</head>
<body class="bg-dark">
  <div class="container-fluid py-3">
    <a href="/results/<%= typeof screeningId !== 'undefined' ? screeningId : '' %>" class="back-button">
      <i class="fas fa-arrow-left"></i> Back to Results
    </a>

    <% 
      // Safely compute education string with var (avoid let/const inside EJS)
      var educationText = 'Not Specified';
      var ed = resume && resume.education;
      if (ed) {
        if (typeof ed === 'string') {
          educationText = ed;
        } else if (Array.isArray(ed)) {
          educationText = ed.filter(Boolean).join(', ');
        } else if (typeof ed === 'object') {
          var parts = [];
          if (ed.level || ed.degree) parts.push(ed.level || ed.degree);
          if (ed.field) parts.push(ed.field);
          if (ed.institution || ed.university) parts.push(ed.institution || ed.university);
          if (ed.year) parts.push(ed.year);
          educationText = parts.filter(Boolean).join(' • ');
        } else {
          educationText = String(ed);
        }
      }
    %>

    <div class="row g-3">
      <!-- Left: Personal info (dark pane) -->
      <div class="col-12 col-lg-4">
        <div class="p-4 rounded-3 h-100 profile-sidebar" style="background:#0f172a;">
          <div class="d-flex flex-column align-items-center">
            <div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center mb-3" style="width:96px;height:96px;">
              <i class="fas fa-user text-white-50 fs-1"></i>
            </div>
            <h3 class="candidate-name mb-1 text-light">
              <%= (resume && resume.candidateName) ? resume.candidateName : 'Unknown Candidate' %>
            </h3>
            <div class="candidate-title text-light-50 mb-3">
              <%= (resume && resume.positions && resume.positions.length > 0) ? resume.positions[0] : 'No position specified' %>
            </div>
          </div>

          <hr class="border-secondary" />

          <!-- Contact details -->
          <div class="mt-3">
            <div class="contact-item d-flex align-items-center mb-2">
              <i class="fa fa-envelope me-2"></i>
              <% if (resume && resume.email) { %>
                <a class="link-light" href="mailto:<%= resume.email %>"><%= resume.email %></a>
              <% } else { %>
                <span class="text-light-50">No email</span>
              <% } %>
            </div>

            <div class="contact-item d-flex align-items-center mb-2">
              <i class="fa fa-phone me-2"></i>
              <span><%= (resume && resume.phone) ? resume.phone : 'No phone' %></span>
            </div>

            <div class="contact-item d-flex align-items-center mb-2">
              <i class="fa fa-briefcase me-2"></i>
              <span><%= (resume && typeof resume.experienceYears !== 'undefined') ? (resume.experienceYears + ' years') : 'Experience not specified' %></span>
            </div>

            <div class="contact-item d-flex align-items-center mb-2">
              <i class="fa fa-graduation-cap me-2"></i>
              <span><%= educationText %></span>
            </div>

            <div class="contact-item d-flex align-items-center">
              <i class="fa fa-file-alt me-2"></i>
              <span class="resume-file-name">
                <%= (resume && resume.originalName) ? resume.originalName : (resume && resume.filename ? resume.filename : 'No file') %>
              </span>
            </div>
          </div>

          <div class="mt-4 d-flex flex-wrap gap-2">
            <% if (resume && Array.isArray(resume.skills) && resume.skills.length) { %>
              <% resume.skills.slice(0, 20).forEach(function(skill) { %>
                <span class="badge rounded-pill bg-secondary-subtle text-light border-0 tag"><%= skill %></span>
              <% }) %>
            <% } else { %>
              <span class="text-light-50">No skills extracted</span>
            <% } %>
          </div>

          <div class="mt-4 small text-light-50">
            Uploaded: <%= (resume && resume.uploadDate) ? new Date(resume.uploadDate).toLocaleDateString() : '—' %>
          </div>
        </div>
      </div>

      <!-- Right: Resume content (high-contrast, readable) -->
      <div class="col-12 col-lg-8">
        <div class="resume-card h-100">
          <h5 class="mb-3">
            <i class="fas fa-file-alt me-2"></i> Resume Content
          </h5>
          <% if (resume && resume.extractedText) { %>
            <div class="extracted-text-container">
              <pre class="mb-0" style="white-space:pre-wrap;background:#ffffff;color:#0f172a;border:1px solid #e2e8f0;border-radius:12px;padding:1rem;line-height:1.55;font-size:0.95rem;"><%= resume.extractedText %></pre>
            </div>
          <% } else { %>
            <div class="alert alert-warning mb-0">
              The resume content could not be extracted or processed. This may be due to an unsupported file format or a processing error.
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>